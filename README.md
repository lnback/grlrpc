# grl-rpc
Just for study

RPC(Remote Procedure Call，远程过程调用)是一种计算机通信协议，允许调用不同进程空间的程序。RPC 的客户端和服务器可以在一台机器上，也可以在不同的机器上。程序员使用时，就像调用本地程序一样，无需关注内部的实现细节。


## 实现功能
### 消息编码
使用了`encoding/gob`实现消息的编解码（序列化和反序列化），后期可以增加JSON的编解码

### 服务发现与注册中心
- 服务发现：
GrlRegistryDiscovery维护一个服务列表，默认 10s 过期，即 10s 之后，需要从注册中心更新新的列表。
- 注册中心：
grl-rpc实现了一个简单的支持心跳保活的注册中心。首先定义 GrlRegistry 结构体，默认超时时间设置为 5 min，也就是说，任何注册的服务超过 5 min，即视为不可用状态。

为GrlRegistry实现了添加服务实例和返回服务列表的方法，为了实现上的**简单**，GrlRegistry使用了额HTTP协议提供服务，所有的有用信息都在HTTP Header中。
- GET:返回所有的可用服务列表
- POST:添加服务实例或者发送心跳

### 超时处理
超时处理是一个RPC框架一个基本的能力，如果缺少超时处理机制，无论是服务端还是客户端都容易因为网络或其他错误导致挂死，资源耗尽。
服务端需要超时处理的地方有：
- 读取客户端请求报文时，读报文导致的超时
- 发送响应报文时，写报文导致的超时
- 调用映射服务的方法时，处理报文导致的超时

### 负载均衡
假设有多个服务实例，每个实例提供相同的功能，为了提高整个系统的吞吐量，每个实例部署在不同的机器上。客户端可以选择任意一个实例进行调用，获取想要的结果。那如何选择呢？取决了负载均衡的策略。

在本框架中仅仅使用了随机选择策略和轮询算法
- 随机选择策略 - 从服务列表中随机选择一个。
- 轮询算法(Round Robin) - 依次调度不同的服务器，每次调度执行 i = (i + 1) mode n。 
